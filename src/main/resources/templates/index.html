<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API bookPoint</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
        }
        .endpoint-list {
            max-height: 400px;
            overflow-y: auto;
        }
        #version {
            color: #a9a9a9;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-4">API bookPoint</h1>
    <p id="version" class="mb-4">author: Andrei Saroka </br>version 1.0</p>
    <div class="row">
        <!-- Поле для JWT токена -->
        <div class="col-12 mb-4">
            <label for="jwtToken" class="form-label">JWT Token</label>
            <input type="text" id="jwtToken" class="form-control" placeholder="Enter your JWT token here">
        </div>

        <!-- Список эндпоинтов -->
        <div class="col-md-4">
            <h4>Endpoints</h4>
            <div class="accordion" id="endpointAccordion">
                <!-- Категории эндпоинтов будут добавлены через JavaScript -->
            </div>
        </div>

        <!-- Форма для запроса -->
        <div class="col-md-8">
            <h4>Request & Response</h4>
            <div class="mb-3">
                <label for="requestMethod" class="form-label">HTTP Method</label>
                <select class="form-select" id="requestMethod">
                    <option value="GET" selected>GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="requestBody" class="form-label">Request Body (JSON)</label>
                <textarea class="form-control" id="requestBody" rows="5" placeholder="Enter JSON body for POST/PUT requests"></textarea>
            </div>
            <button class="btn btn-primary mb-3" id="sendRequest">Send Request</button>
            <h5>Response:</h5>
            <pre id="responseOutput" class="p-3 border bg-light" style="height: 300px; overflow-y: auto;"></pre>
        </div>
    </div>
</div>

<script>
    // Список эндпоинтов, сгруппированных по категориям
    const endpoints = {
        "Test to work": [
            { name: "Get Api status", method: "GET", url: "/api/health" }
        ],
        "RoomController": [
            { name: "Get All Rooms", method: "GET", url: "/room/all" },
            { name: "Get Room by ID", method: "GET", url: "/room/{id}" },
            { name: "Create Room", method: "POST", url: "/room/create" },
            { name: "Update Room", method: "PUT", url: "/room/{id}" },
            { name: "Delete Room", method: "DELETE", url: "/room/{id}" }
        ],
        "PointController": [
            { name: "Get All Point in Room", method: "GET", url: "/room/{roomId}/point/all" },
            { name: "Get Point in Room by Id", method: "GET", url: "/room/{roomId}/point/{id}" },
            { name: "Create Point", method: "POST", url: "/room/{roomId}/point/create" },
            // { name: "Update Point", method: "PUT", url: "/api/rooms/{roomId}/desks/{deskId}" },
            { name: "Delete Point in Room by Number", method: "DELETE", url: "/room/{roomId}/point/number" },
            // { name: "Check Desk Availability", method: "GET", url: "/api/rooms/{roomId}/desks/{deskId}/availability" }
        ],
        // "BookingController": [
        //     { name: "Get All Bookings", method: "GET", url: "/api/bookings" },
        //     { name: "Get Booking by ID", method: "GET", url: "/api/bookings/{id}" },
        //     { name: "Create Booking", method: "POST", url: "/api/bookings" },
        //     { name: "Cancel Booking", method: "DELETE", url: "/api/bookings/{id}" }
        // ],
        "UserController need review": [
            { name: "Get All Users", method: "GET", url: "/api/users" },
            { name: "Get User by ID", method: "GET", url: "/api/users/{id}" },
            { name: "Create User", method: "POST", url: "/api/users" },
            { name: "Update User", method: "PUT", url: "/api/users/{id}" },
            { name: "Delete User", method: "DELETE", url: "/api/users/{id}" }
        ]
    };

    const endpointAccordion = document.getElementById("endpointAccordion");
    const requestMethod = document.getElementById("requestMethod");
    const requestBody = document.getElementById("requestBody");
    const responseOutput = document.getElementById("responseOutput");
    const sendRequestButton = document.getElementById("sendRequest");
    const jwtTokenInput = document.getElementById("jwtToken");

    let selectedEndpoint = null;

    // Заполнить список эндпоинтов по категориям
    Object.keys(endpoints).forEach((category, index) => {
        const categoryId = `category-${index}`;
        const endpointsList = endpoints[category].map((endpoint, endpointIndex) => `
                <li class="list-group-item list-group-item-action"
                    data-url="${endpoint.url}"
                    data-method="${endpoint.method}">
                    ${endpoint.method} ${endpoint.name}
                </li>
            `).join("");

        endpointAccordion.innerHTML += `
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading-${categoryId}">
                        <button class="accordion-button collapsed" type="button"
                                data-bs-toggle="collapse" data-bs-target="#collapse-${categoryId}"
                                aria-expanded="false" aria-controls="collapse-${categoryId}">
                            ${category}
                        </button>
                    </h2>
                    <div id="collapse-${categoryId}" class="accordion-collapse collapse"
                         aria-labelledby="heading-${categoryId}">
                        <div class="accordion-body">
                            <ul class="list-group">
                                ${endpointsList}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
    });

    // Обработчик выбора эндпоинта
    endpointAccordion.addEventListener("click", (event) => {
        if (event.target.classList.contains("list-group-item")) {
            selectedEndpoint = {
                url: event.target.getAttribute("data-url"),
                method: event.target.getAttribute("data-method")
            };
            requestMethod.value = selectedEndpoint.method;
            requestBody.value = ""; // Очистить тело запроса
            responseOutput.textContent = ""; // Очистить ответ
            document.querySelectorAll(".list-group-item").forEach(el => el.classList.remove("active"));
            event.target.classList.add("active");
        }
    });

    // Обработчик отправки запроса
    sendRequestButton.addEventListener("click", async () => {
        if (!selectedEndpoint) {
            alert("Please select an endpoint first.");
            return;
        }
        // const baseUrl = "http://localhost:8080"; // здесь базовый URL
        const baseUrl = "https://https://bookpoint-production.up.railway.app";
        const url = baseUrl + selectedEndpoint.url.replace(/\{.*?\}/g, "1"); // Замена {id} на тестовое значение
        const method = requestMethod.value;
        const body = requestBody.value;
        const jwtToken = jwtTokenInput.value.trim();

        try {
            const options = {
                method,
                headers: {
                    "Content-Type": "application/json",
                    ...(jwtToken && { "Authorization": `Bearer ${jwtToken}` }) // Добавить токен если он введен
                },
            };
            if (method === "POST" || method === "PUT") {
                options.body = body;
            }

            const response = await fetch(url, options);
            const data = await response.json();
            responseOutput.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
            responseOutput.textContent = `Error: ${error.message}`;
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
